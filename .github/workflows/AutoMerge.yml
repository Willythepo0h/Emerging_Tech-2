name: Automerge Changes to app.py

on:
  push:
    branches:
      - main

jobs:
  automerge:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Git
      run: |
        git config user.name "Your Name"
        git config user.email "youremail@example.com"

    - name: Merge Pull Requests
      run: |
        PR_COUNT=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" "https://api.github.com/repos/${{ github.repository }}/pulls?state=open" | jq length)
        if [ $PR_COUNT -gt 0 ]; then
          for ((i = 1; i <= $PR_COUNT; i++)); do
            git fetch origin pull/$i/head:pr/$i
            git checkout pr/$i
            collaborator_name=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" "https://api.github.com/repos/${{ github.repository }}/pulls/$i" | jq -r .user.login)
            git merge main --no-edit -m "Merge #${i} from ${collaborator_name}"
            git push origin pr/$i
          done
        fi
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
